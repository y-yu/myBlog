# 改行すると半角スペースが入る件

個人的には致命的だと思ったのでまとめた。

## 経緯

僕はいろいろTeXを使うので、そのノリでこのブログを書いていたところ、
わけの分からん所に半角スペースが侵入してきた。
いろいろ調べてみると、どうやらこのMarkdownがHTMLに変換されると
問題が露出するらしい。

例えば、

```
すごく長い文章を書いてきたのでそろそろ改行するが、
これは段落ではない。
```

と、普通にMarkdownで書く。
TeXでは当然この改行は無視され、
TeXの判断した適切な場所で改行が行なわれる。

```
すごく長い文章を書いてきたのでそろそろ改行するが、これは段落ではない。
```

しかしGitHubのAPIでHTMLに変換し、
ブラウザで見ると次のようになってしまう。

```
すごく長い文章を書いてきたのでそろそろ改行するが、 これは段落ではない。
```

見辛いかもしれないが、半角スペースが侵入している。
これは一体どうなってるのか知らべた。

## GitHub APIのミス？

GitHub APIのミスかその仕様であると疑い、
とりあえず変換後のHTMLソースを見てみた。

```
<p>そもそもGitHubでブログとか抜かし始めたのは、この拡張マークダウン記法があったからだと思う。
とりあえずソースコードを綺麗に貼れるだけでポイントが高いし、
厄介な手続きを踏んで、アカウントを取得する手間もかからんので楽だろうと思った。
試しにソースを載せると非常に美しく表示される。</p>
```

どこにも半角スペースはなかった。
つまりは`<p>`タグの仕様によって、
改行が半角スペースになっていると見た。

## `white-space`属性

`<p>`タグを調べていると、
`white-space`という属性があると気付いた。
[適当なサイト](http://www.tagindex.com/stylesheet/text_font/white_space.html)によると、
これは次のような指定が出来るらしい。

* nomal
	* **連続する半角スペース、改行、タブは、1つの半角スペースにまとめられて表示されます。**
    * 幅いっぱいのところで、自動的な折り返しが行われます。
* nowrap
    * 連続する半角スペース、改行、タブは、1つの半角スペースにまとめられて表示されます。
    * 自動的な折り返しは行われません。領域の幅を超えたテキストは、はみ出して（または横スクロールで）表示されます。
* pre
	* 連続する半角スペース、改行、タブは、記述した通りの形で表示されます。
    * 自動的な折り返しは行われません。領域の幅を超えたテキストは、はみ出して（または横スクロールで）表示されます。

まあ、改行は半角スペースになっているので`pre`はない、
自動的に折り返しているので`nowrap`はないとなると、
GitHubでは`normal`が使われているということになる。

まあ念のため、GitHubのページをFirebugで調べてみたが、
やはり`normal`であろうという結論を得た。

### どうしてこうなった

恐らくは英語の記述をやりやすくするためと思う。
例えば英語なら次のように書いた時、
いちいちスペースを入れなくて済む。

```
This is a pen.
I like this.
```

とすれば、

```
This is a pen. I like this.
```

こうなるので、英語圏の人々はハッピーなのだろうが、
日本語のように、スペースを使う習慣がない言語を操る民族にとっては邪魔でしかない。

## なんとかする

第二次世界大戦で日本が負けたことを悔やんでも仕方ないので、
なんとか快適なブログライフを継続させるため、問題の解決を目指す。

とりあえず、三つの解決策があると思う。

1. 英語でブログを書く
2. Vimの機能で、表示行と実際の行を分ける
3. プログラムで改行を取り除く

一は僕の能力からしてNG。
二は調べてみたけど、いい感じに解決する方法がなかったので、
今回は三で行くことにした。

## プログラムでMarkdownファイルの改行を消し去る

### 意味ある改行を残す

Markdownは意味のある改行が存在するので、
それをまずは列挙しておく。

* 見出し
* 箇条書き
* ソースコード
* 引用

これらは正規表現で選択することにした。
Perl6を使えばこういうのは楽そうだけど、
最近は全く書いてなくてほとんど忘れたのでPerlで書いた。

### 自動プレビュー

[前回の記事](https://github.com/yoshimuraYuu/myBlog/blob/master/articles/startup.md)で書いたように、
この記事はOMakeで自動的にプレビューが作らているので、
OMakefileを少々修正した。

まあ、`.SUBDIRS`を使えば簡単に出来る。

## まとめ

ということで、なんとか改行を消し飛ばすことに成功した。
めでたしめでたし。
